<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Drill DQ · Cleansing</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Global styles + overview shared components -->
  <link rel="stylesheet" href="/static/css/style.css"/>
  <link rel="stylesheet" href="/static/css/overview.css"/>
  <link rel="stylesheet" href="/static/css/stepper.css"/>
  <!-- Page specific -->
  <link rel="stylesheet" href="/static/css/cleansing.css"/>
</head>
<body>
  <!-- Logo -->
  <img src="/static/asset/Logo.jpg" alt="Drill DQ Logo" class="page-logo">

  <!-- Back button -->
  <div class="back-button-container">
    <button class="back-btn" onclick="window.location.href='/'">
      <span class="back-icon">←</span>
      <span class="back-text">Back to Upload</span>
    </button>
  </div>

  <!-- Modern Stepper -->
  <nav class="modern-stepper" data-progress="50" role="navigation" aria-label="Data quality process steps">
    <div class="step-item completed" role="listitem">
      <div class="step-bubble" aria-label="Step 1: Overview - Completed">
        <svg class="step-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
        </svg>
      </div>
      <div class="step-label">Overview</div>
    </div>
    <div class="step-item active" role="listitem" aria-current="step">
      <div class="step-bubble" aria-label="Step 2: Cleansing - Current step">
        <svg class="step-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M14.73 13.31c1.13-1.55 1.63-3.58.98-5.74-1.22-.01-2.43.49-3.34 1.39-.57.57-.93 1.32-.93 2.13 0 .21.04.42.11.62-.4.05-.8-.03-1.15-.21-.78-.4-1.35-1.09-1.61-1.89-.39-1.21-.04-2.52.95-3.44 1.05-1.04 2.55-1.42 3.94-1.02.54.16 1.05.43 1.47.82.37.33.67.75.88 1.22.59-.16 1.21-.13 1.78.12 1.31.57 2.16 1.93 2.06 3.36-.1 1.45-.91 2.71-2.12 3.36-.61.33-1.29.49-1.98.46z"/>
        </svg>
      </div>
      <div class="step-label">Cleansing</div>
    </div>
    <div class="step-item" role="listitem">
      <div class="step-bubble" aria-label="Step 3: Anomalies">
        <svg class="step-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
      <div class="step-label">Anomalies</div>
    </div>
    <div class="step-item" role="listitem">
      <div class="step-bubble" aria-label="Step 4: Export">
        <svg class="step-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
        </svg>
      </div>
      <div class="step-label">Export</div>
    </div>
  </nav>

  <main>

    <!-- Actions -->
    <section class="actions-section revealed">
      <div class="section-header">
        <h3>Choose cleansing actions</h3>
        <p>These are safe defaults. You can tweak and preview before applying.</p>
      </div>

      <div class="action-grid">

        <!-- Deduplicate -->
        <div class="action-card" data-action="deduplicate">
          <div class="action-head">
            <label class="switch">
              <input type="checkbox" id="toggleDedup" checked>
              <span class="slider"></span>
            </label>
            <h4>Remove duplicates</h4>
            <p>Drop duplicate rows. Default: entire row match.</p>
          </div>
          <div class="action-body">
            <div class="form-row">
              <label for="dedupSubset">Subset (optional)</label>
              <select id="dedupSubset" multiple aria-label="Deduplicate subset columns"></select>
            </div>
            <div class="hint">Tip: choose ID-like columns for faster, precise duplicate removal.</div>
          </div>
        </div>

        <!-- Standardize -->
        <div class="action-card" data-action="standardize">
          <div class="action-head">
            <label class="switch">
              <input type="checkbox" id="toggleStandardize" checked>
              <span class="slider"></span>
            </label>
            <h4>Standardize aliases & units</h4>
            <p>Map column aliases and convert units (e.g., <code>pressure_psi→pressure_bar</code>).</p>
          </div>
          <div class="action-body">
            <ul class="tiny-list" id="stdPreview">
              <!-- filled from server: alias targets & unit targets -->
            </ul>
          </div>
        </div>

        <!-- Impute -->
        <div class="action-card" data-action="impute">
          <div class="action-head">
            <label class="switch">
              <input type="checkbox" id="toggleImpute" checked>
              <span class="slider"></span>
            </label>
            <h4>Fill missing values</h4>
            <p>Numeric → median · Categorical → mode</p>
          </div>
          <div class="action-body">
            <div class="hint">We use robust defaults (median/mode). You can refine later.</div>
            <details class="details">
              <summary>See columns with missing</summary>
              <ul id="missingCols" class="tiny-list"></ul>
            </details>
          </div>
        </div>

      </div>

      <div class="action-footer">
        <button class="secondary-btn" id="btnReset">Reset</button>
        <button class="primary-btn" id="btnPreview">
          <span>Preview changes</span>
          <div class="btn-icon">⏵</div>
        </button>
      </div>
    </section>

    <!-- Preview / Apply -->
    <section class="preview-section hidden" id="previewSection">
      <div class="section-header">
        <h3>Preview impact</h3>
        <p>Compare before vs after and review the change log</p>
      </div>

      <div class="kpi-compare">
        <div class="kpi-col">
          <div class="kpi-head">Before</div>
          <div class="kpi-row"><span class="kpi-label">Rows</span><span id="prevRows">-</span></div>
          <div class="kpi-row"><span class="kpi-label">Duplicates</span><span id="prevDups">-</span></div>
          <div class="kpi-row"><span class="kpi-label">Completeness</span><span id="prevComp">-</span></div>
        </div>
        <div class="kpi-col arrow">→</div>
        <div class="kpi-col">
          <div class="kpi-head">After (preview)</div>
          <div class="kpi-row"><span class="kpi-label">Rows</span><span id="afterRows">-</span></div>
          <div class="kpi-row"><span class="kpi-label">Duplicates</span><span id="afterDups">-</span></div>
          <div class="kpi-row"><span class="kpi-label">Completeness</span><span id="afterComp">-</span></div>
        </div>
      </div>

      <div class="log-section">
        <h4>Change log</h4>
        <ul id="changeLog" class="tiny-list"></ul>
      </div>

      <div class="preview-footer">
        <button class="secondary-btn" id="btnBackToActions">
          <span>Back to actions</span>
          <div class="btn-icon">↑</div>
        </button>
        <button class="primary-btn" id="btnApply">
          <span>Apply & Continue to Anomalies</span>
          <div class="btn-icon">→</div>
        </button>
      </div>
    </section>
  </main>

  <footer><small class="muted">© 2025 Drill DQ</small></footer>

  <script src="/static/js/stepper.js"></script>
  <script src="/static/js/cleansing-page/cleansing.js"></script>
</body>
</html>
